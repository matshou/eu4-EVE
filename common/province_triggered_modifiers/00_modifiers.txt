# Province Triggered modifiers are here.
# These are added to provinces through the add_province_triggered_modifier effect
#
# Effects are fully scriptable here.

# Scope: province(ROOT)
# This trigger fires once each month, use it to handle stuff that 
# depend on monthly updates (can use country and global scope)
#
monthly_pulse = {
	potential = {
		always = yes
	}

	trigger = {
		custom_trigger_tooltip = {
			tooltip = MONTHLY_PULSE_TT 
			always = yes
		}
	}
	
	local_production_efficiency = 0.15
	local_tax_modifier = 0.3 
	
	# Gets called on each new day
	on_activation = {
		if = { 
			limit = { owner = { NOT = { check_variable = { which = month_pulse_eta value = 1 } } } }
			
			owner = { 
				#log = "EVE: Monthly pulse fired for [This.GetName]([This.country_id.GetValue]) from [Root.GetName]([Root.owner_id.GetValue])"
				
				reset_monthly_pulse = yes
				check_for_territorial_change = yes
				
				# Triggers only for player, do all GLOBAL stuff here:
				if = { limit = { ai = no }
				
					# Check on each pulse to see if a new country formed
					every_country = {
						limit = { NOT = { has_country_flag = is_initialized } }
						initialize_country = yes
					}
				}
			}
			
			# This triggers when the capital gets moved to another 
			# province or the previous owner gets annexed
			#
			if = {
				limit = { NOT = { is_capital = yes } }
				remove_province_triggered_modifier = monthly_pulse
				
				owner = {
					# This province was gained as a concession in a war or
					# for other reasons has ended up as territory of another country
					if = {
						limit = { ROOT = { has_province_flag = conquered_capital } }
						
						# Find capital province previous owner
						every_known_country = {
							limit = { ROOT = { previous_owner = PREV } }
							
							changed_capital_province = yes						# previous owner
							
							PREV = { 											# current owner
								set_country_flag = territorial_change         
								fire_monthly_pulse = yes
							}
						}
						# Previous owner has most probably been annexed
						#if = { 
						#	limit = { NOT = { has_country_flag = territorial_change } }
						#	log = "EVE: ERROR(conquered capital [Root.GetName] with unknown previous owner)"
						#}
						ROOT = { clr_province_flag = conquered_capital }
					}					
					# Owner changed its capital province with diplomatic power or an event
					else_if = {
						limit = { NOT = { ROOT = { has_province_flag = changed_ownership } } }
						changed_capital_province = yes
					}
				}
			}
			# Do this when we run the mod for the FIRST TIME this campaign.
			# It has to be run from here because the ROOT scope is set to capital province.
			#
			else_if = {
				limit = { NOT = { had_global_flag = { flag = eve_initialized days = 32 } } }
				owner = { calc_country_dist_autonomy = yes }
			}
			# Owner country has either gained new territory or changed its capital province
			else_if = {
				limit = { owner = { has_country_flag = territorial_change } }
				owner = {
					log = "EVE: [This.GetName] had territorial changes recently."
					calc_country_dist_autonomy = yes 
				}
			}
		}
		else = { 
			owner = { 
				subtract_variable = { which = month_pulse_eta value = 1 }
			    #log = "EVE: [Prev.GetName]: month pulse eta: [This.month_pulse_eta.GetValue]."  #Debug
			}
		}
	}
	
	# This should only fire when we remove the modifier via "remove_province_modifier"
	on_deactivation = {
		owner = { 
			log = "EVE: Monthly pulse deactivated."
		}
	}
	
}

non_catholic_rome = {
	potential = {
		normal_or_historical_nations = yes
	}
	
	#viewer = {
	#}
	
	trigger = {
		owner = {
			NOT = { religion = catholic }
			OR = {
				religion_group = christian
				religion_group = muslim
			}
		}
	}

	prestige = 0.5
	missionaries = 1
	
	#Province scope
	on_activation = {
	
	}
	
	on_deactivation = {
	
	}
	
}

religious_center = {
	potential = {
	}
	
	#viewer = {
	#}
	
	trigger = {
		if = {
			limit = {
				province_id = 118 # Roma
			}
			religion = catholic
		}
		else_if = {
			limit = {
				province_id = 385 # Mecca
			}
			religion = sunni
		}
		else_if = {
			limit = {
				province_id = 409 # Hillah
			}
			religion = shiite
		}
		else_if = {
			limit = {
				province_id = 677
			}
			religion = vajrayana
		}
		else_if = {
			limit = {
				province_id = 2075
			}
			religion = sikhism
		}
		else_if = {
			limit = {
				province_id = 2095
			}
			religion = hinduism
		}
		else_if = {
			limit = {
				province_id = 2099
			}
			religion = buddhism
		}
		else_if = {
			limit = {
				province_id = 2311
			}
			religion = shiite
		}
		else_if = {
			limit = {
				province_id = 2221
			}
			religion = shiite
		}
		else_if = {
			limit = {
				province_id = 4359
			}
			religion = shinto
		}
	}

	local_missionary_strength = -0.05
	
	#Province scope
	on_activation = {
	
	}
	
	on_deactivation = {
	
	}
	
}

#Coptic control of Alexandria

coptic_alexandria = {
	potential = {
		normal_or_historical_nations = yes
	}
	
	#viewer = {
	#}
	
	trigger = {
		owner = {
			religion = coptic
		}
	}
	
	prestige = 0.5
	missionaries = 1
	tolerance_own = 1
	
	#Province scope
	on_activation = {
	
	}
	
	on_deactivation = {
	
	}
	
}

#Therevada Control of sacred tooth

theravada_kotte = {
	potential = {
		normal_or_historical_nations = yes
	}
	
	#viewer = {
	#}
	
	trigger = {
		owner = {
			religion = buddhism
		}
	}
	
	prestige = 0.5
	missionaries = 1
	tolerance_own = 1
	
	#Province scope
	on_activation = {
	
	}
	
	on_deactivation = {
	
	}
	
}

#Vajrayana Control of Lhasa

vajrayana_lhasa = {
	potential = {
		normal_or_historical_nations = yes
	}
	
	#viewer = {
	#}
	
	trigger = {
		owner = {
			religion = vajrayana
		}
	}
	
	prestige = 0.5
	missionaries = 1
	tolerance_own = 1
	
	#Province scope
	on_activation = {
	
	}
	
	on_deactivation = {
	
	}
	
}

#Mahayana control of Louyang

mahayana_louyang = {
	potential = {
		normal_or_historical_nations = yes
	}
	
	#viewer = {
	#}
	
	trigger = {
		owner = {
			religion = mahayana
		}
	}
	
	prestige = 0.5
	missionaries = 1
	tolerance_own = 1
	
	#Province scope
	on_activation = {
	
	}
	
	on_deactivation = {
	
	}
	
}

#Buddhist control of Bodh Gaya

buddhist_bodh_gaya = {
	potential = {
		normal_or_historical_nations = yes
	}
	
	#viewer = {
	#}
	
	trigger = {
		owner = {
			OR = {
				religion = buddhism
				religion = vajrayana
				religion = mahayana
			}
		}
	}
	
	prestige = 0.5
	missionaries = 1
	global_heretic_missionary_strength = 0.02
	
	#Province scope
	on_activation = {
	
	}
	
	on_deactivation = {
	
	}
	
}

# Hindu control of Varanasi

hindu_varanasi = {
	potential = {
		normal_or_historical_nations = yes
	}
	
	#viewer = {
	#}
	
	trigger = {
		owner = {
			religion = hinduism
		}
	}
	
	prestige = 0.5
	missionaries = 1
	tolerance_own = 1
	
	#Province scope
	on_activation = {
	
	}
	
	on_deactivation = {
	
	}
	
}

# Inti control of Pachamac

inti_lima = {
	potential = {
		normal_or_historical_nations = yes
	}
	
	#viewer = {
	#}
	
	trigger = {
		owner = {
			religion = inti
			is_religion_reformed = yes
		}
	}
	
	prestige = 0.5
	missionaries = 1
	tolerance_own = 1
	
	#Province scope
	on_activation = {
	
	}
	
	on_deactivation = {
	
	}
	
}

#Nahuatl control of cholulula

nahuatl_cholula = {
	potential = {
		normal_or_historical_nations = yes
	}
	
	#viewer = {
	#}
	
	trigger = {
		owner = {
			religion = nahuatl
			is_religion_reformed = yes
		}
	}
	
	prestige = 0.5
	missionaries = 1
	tolerance_own = 1
	
	#Province scope
	on_activation = {
	
	}
	
	on_deactivation = {
	
	}
	
}

# Mayan control of Chichen Itza

mayan_chichen_itza = {
	potential = {
		normal_or_historical_nations = yes
	}
	
	#viewer = {
	#}
	
	trigger = {
		owner = {
			religion = mesoamerican_religion
			is_religion_reformed = yes
		}
	}
	
	prestige = 0.5
	missionaries = 1
	tolerance_own = 1
	
	#Province scope
	on_activation = {
	
	}
	
	on_deactivation = {
	
	}
	
}

# Sikh control of Amritsar

sikh_amritsar = {
	potential = {
		normal_or_historical_nations = yes
	}
	
	#viewer = {
	#}
	
	trigger = {
		owner = {
			religion = sikhism
		}
		religion = sikhism
	}
	
	prestige = 0.5
	missionaries = 1
	tolerance_own = 1
	
	#Province scope
	on_activation = {
	
	}
	
	on_deactivation = {
	
	}
	
}

# Christian control of Mecca

christian_mecca = {
	potential = {
		normal_or_historical_nations = yes
	}
	
	#viewer = {
	#}
	
	trigger = {
		owner = {
			religion_group = christian
		}
	}
	
	prestige = 0.5
	missionaries = 1
	tolerance_own = 1
	
	#Province scope
	on_activation = {
	
	}
	
	on_deactivation = {
	
	}
	
}

# Jerusalem held by any Abrahamic faith

jerusalem_held = {
	potential = {
		normal_or_historical_nations = yes
	}
	
	#viewer = {
	#}
	
	trigger = {
		owner = {
			OR = {
				religion_group = christian
				religion_group = muslim
				religion = jewish
			}
		}
	}
	
	prestige = 0.5
	missionaries = 1
	global_heretic_missionary_strength = 0.02
	
	#Province scope
	on_activation = {
	
	}
	
	on_deactivation = {
	
	}
	
}